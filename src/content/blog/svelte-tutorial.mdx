---
title: 'Svelte æ•™ç¨‹'
description: ''
date: '2025-11-04'
---

use-intersection-observer.svelte.ts

```ts
export function useIntersectionObserver(options: IntersectionObserverInit) {
  let element = $state<Element | null>(null)
  let isIntersecting = $state(false)
  let hasIntersected = $state(false) // è®°å½•æ˜¯å¦å·²ç»äº¤å‰è¿‡

  $effect(() => {
    if (!element) return

    const observer = new IntersectionObserver(([entry]) => {
      isIntersecting = entry.isIntersecting
      // ä¸€æ—¦è¿›å…¥è§†å£ï¼Œå°±æ ‡è®°ä¸ºå·²äº¤å‰
      if (entry.isIntersecting) {
        hasIntersected = true
      }
    }, options)

    observer.observe(element)

    return () => observer.disconnect()
  })

  return {
    get isIntersecting() {
      return isIntersecting
    },
    get hasIntersected() {
      return hasIntersected
    },
    ref: (node: Element) => {
      element = node
    },
  }
}
```

## In viewport transition

```svelte
 <div
	use:observer.ref
	class={cn(
		'flex flex-col py-2 transition-transform duration-500 ease-out',
		observer.hasIntersected ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0'
	)}
	style="gap: {rowGapPx}px;"
>
	{#each rowsData as rowData (rowData?.key)}
		<AnimatedRow>
			<div class="flex" style="gap: {gapPx}px;">
				{#each rowData!.presets as preset, index}
					<PresetButton {preset} />
				{/each}
			</div>
		</AnimatedRow>
	{/each}
</div>
```

æˆ–

```svelte
<!-- åœ¨é…åˆ {#key} å—ä½¿ç”¨æ—¶ï¼Œå¦‚æœä½ åªéœ€è¦"å‡ºç°"çš„åŠ¨ç”»æ•ˆæœï¼Œåº”è¯¥ä½¿ç”¨ in:fly è€Œä¸æ˜¯ transition:flyï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„é€€å‡ºåŠ¨ç”»å¹²æ‰°ï¼Œè®©åŠ¨ç”»è¡¨ç°æ›´åŠ å¯é¢„æµ‹å’Œæµç•…ã€‚ -->
{#key observer.hasIntersected}
	<div
		use:observer.ref
		in:fly={{ y: 20, duration: 500, easing: cubicOut }}
		class={cn('flex flex-col py-2')}
		style="gap: {rowGapPx}px; visibility: {observer.hasIntersected ? 'visible' : 'hidden'};"
	>
		{#each rowsData as rowData (rowData?.key)}
			<AnimatedRow>
				<div class="flex" style="gap: {gapPx}px;">
					{#each rowData!.presets as preset, index}
						<PresetButton {preset} />
					{/each}
				</div>
			</AnimatedRow>
		{/each}
	</div>
{/key}
```

åŠ¨æ€å®ç°delay: Tailwind å¤„ç†é™æ€å’Œå¯é¢„æµ‹çš„æ ·å¼ï¼Œè®© style: æŒ‡ä»¤å¤„ç†çœŸæ­£åŠ¨æ€çš„å€¼ã€‚ä¸¤è€…é…åˆä½¿ç”¨æ‰èƒ½å‘æŒ¥æœ€å¤§æ•ˆèƒ½ï¼ğŸš€

```css
style="--delay: {i * 50}ms; transition-delay: var(--delay);"
```
